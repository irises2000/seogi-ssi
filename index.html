<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="style.css" />
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.1.0/papaparse.min.js"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/quiple/hbios-sys@latest/hbios-sys.css" />
  <title>seogi</title>
</head>

<body>
  <div class="date-list" id="date-list"></div>
  <div class="content-box" id="content-box">
    <p id="content-text" style="display: none;"></p>
    <p id="footnote" style="display: none;"></p>
    <a id="link-button" href="#" target="_blank" style="display: none; margin-top: 10px;">ref.ğƒ</a>
    <div class="blank"></div>
  </div>
  <div class="rollingstone" id="rollingstone">
    <p id="stone" onclick="location.href=''">ğŸª¨</p>
  </div>

  <script>
    // Google ìŠ¤í”„ë ˆë“œì‹œíŠ¸ì—ì„œ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¬ CSV URL
    var public_spreadsheet_url =
      "https://docs.google.com/spreadsheets/d/13kWyDNR5larvdzYubROyb9KlqocmFr1_mxDmWAWbqHA/gviz/tq?tqx=out:csv";

    // í˜ì´ì§€ ë¡œë“œ ì‹œ ìŠ¤í”„ë ˆë“œì‹œíŠ¸ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ëŠ” í•¨ìˆ˜ ì‹¤í–‰
    function init() {
      Papa.parse(public_spreadsheet_url, {
        download: true, // ë°ì´í„°ë¥¼ ë‹¤ìš´ë¡œë“œ
        header: true, // ì²« ë²ˆì§¸ í–‰ì„ í—¤ë”ë¡œ ì‚¬ìš©
        complete: showInfo, // ë°ì´í„° íŒŒì‹± ì™„ë£Œ ì‹œ í˜¸ì¶œí•  í•¨ìˆ˜
      });
    }

    // DOM ì½˜í…ì¸  ë¡œë“œ ì™„ë£Œ ì‹œ ì´ˆê¸°í™” í•¨ìˆ˜ ì‹¤í–‰
    window.addEventListener("DOMContentLoaded", init);

    function showInfo(results) {
      var data = results.data; // ìŠ¤í”„ë ˆë“œì‹œíŠ¸ì˜ ë°ì´í„° ë°°ì—´
      var dataLength = data.length; // ë°ì´í„°ì˜ ê¸¸ì´

      // DOM ìš”ì†Œ ì°¸ì¡°
      var dateList = document.getElementById("date-list");
      var contentBox = document.getElementById("content-box");
      var contentText = document.getElementById("content-text");
      var footnoteText = document.getElementById("footnote");
      var linkButton = document.getElementById("link-button");

      var currentVisibleId = null; // í˜„ì¬ í‘œì‹œ ì¤‘ì¸ ì½˜í…ì¸ ì˜ IDë¥¼ ì¶”ì 

      // ë°ì´í„°ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ë‚ ì§œ ëª©ë¡ ìƒì„±
      for (var i = 0; i < dataLength; i++) {
        var dateDiv = document.createElement("div"); // ë‚ ì§œë¥¼ ìœ„í•œ div ìƒì„±
        dateDiv.className = "date"; // ë‚ ì§œ CSS í´ë˜ìŠ¤ ì¶”ê°€
        dateDiv.id = `date-${i}`; // ê³ ìœ  ID ì¶”ê°€
        dateDiv.textContent = data[i].date; // í…ìŠ¤íŠ¸ë¡œ ë‚ ì§œ ì„¤ì •

        // ë‚ ì§œë¥¼ í´ë¦­í–ˆì„ ë•Œ ì‹¤í–‰ë˜ëŠ” ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
        dateDiv.addEventListener("click", function (event) {
          var clickedId = event.target.id.split("-")[1];

          // ëª¨ë“  ë‚ ì§œì—ì„œ 'active' í´ë˜ìŠ¤ ì œê±°
          var allDates = document.querySelectorAll(".date");
          allDates.forEach(function (date) {
            date.classList.remove("active");
          });

          // ê°™ì€ ë‚ ì§œë¥¼ í´ë¦­í•´ë„ 'active' ì œê±°, ë‚´ìš© ìˆ¨ê¹€
          if (currentVisibleId === clickedId) {
            contentText.style.display = "none";
            footnoteText.style.display = "none";
            linkButton.style.display = "none";
            currentVisibleId = null;

            // ë°°ê²½ì„ ê¸°ë³¸ ìƒíƒœë¡œ ë³µì›
            document.body.style.backgroundColor = "";
          } else {
            // í´ë¦­í•œ ë‚ ì§œì— 'active' í´ë˜ìŠ¤ ì¶”ê°€
            event.target.classList.add("active");

            var content = data[clickedId].content || ""; // contentê°€ ì—†ì„ ê²½ìš° ë¹ˆ ë¬¸ìì—´ ì²˜ë¦¬
            var footnote = data[clickedId].footnote || ""; // footnoteê°€ ì—†ì„ ê²½ìš° ë¹ˆ ë¬¸ìì—´ ì²˜ë¦¬
            var link = data[clickedId].link || ""; // linkê°€ ì—†ì„ ê²½ìš° ë¹ˆ ë¬¸ìì—´ ì²˜ë¦¬

            // contentì—ì„œ 'â‘´', 'â‘µ' ë“± ê°ì£¼ë¥¼ ì°¾ì•„ ë§í¬ë¡œ ë³€í™˜
            var contentWithReferences = content.replace(
              /â¶|â·|â¸|â¹|âº|â»|â¼|â½/g, // ê°ì£¼ ë²ˆí˜¸ì— í•´ë‹¹í•˜ëŠ” íŒ¨í„´
              function (match) {
                return `<span class="reference" data-ref="${match}">${match}</span>`;
              }
            );

            var footnoteWithLineBreaks = footnote.replace(
              /(?:\r\n|\r|\n)/g,
              "<br>"
            );

            contentText.innerHTML = contentWithReferences; // ë³€í™˜ëœ content ì ìš©
            footnoteText.innerHTML = footnoteWithLineBreaks;
            contentText.style.display = "block";
            footnoteText.style.display = "block";

            if (link) {
              linkButton.href = link;
              linkButton.style.display = "block";
            } else {
              linkButton.style.display = "none";
            }

            currentVisibleId = clickedId;

            // 'â‘´' ë“±ì„ í´ë¦­í–ˆì„ ë•Œ í•´ë‹¹ ê°ì£¼ ë‚´ìš©ì„ ê°•ì¡° ë° ìŠ¤í¬ë¡¤
            document.querySelectorAll(".reference").forEach(function (ref) {
              ref.addEventListener("click", function () {
                var refId = ref.getAttribute("data-ref"); // ê°ì£¼ì˜ ë²ˆí˜¸ ì¶”ì¶œ

                // footnoteì˜ ê° ë¼ì¸ì„ ìˆœíšŒí•˜ë©° ë§¤ì¹­ëœ ê°ì£¼ë¥¼ ê°•ì¡°
                var footnoteLines = footnote.split("\n");
                var highlightedContent = footnoteLines
                  .map(function (line) {
                    if (line.startsWith(refId)) {
                      return `<span class="highlight">${line}</span>`;
                    }
                    return line;
                  })
                  .join("<br>");

                // footnoteTextë¥¼ ì—…ë°ì´íŠ¸
                footnoteText.innerHTML = highlightedContent;

                // ìŠ¤í¬ë¡¤ ì´ë™
                var contentBox = document.getElementById("content-box"); // content-box ìš”ì†Œ ì°¸ì¡°
                var highlightElement = document.querySelector(".highlight"); // ê°•ì¡°ëœ ìš”ì†Œ

                if (highlightElement) {
                  // ê°•ì¡°ëœ ìš”ì†Œì˜ ìœ„ì¹˜ ê³„ì‚°
                  var elementOffsetTop = highlightElement.offsetTop;
                  var contentBoxOffsetTop = contentBox.offsetTop;

                  // content-box ë‚´ë¶€ì—ì„œì˜ ìƒëŒ€ì  ìœ„ì¹˜ë¡œ ìŠ¤í¬ë¡¤ ì„¤ì •
                  contentBox.scrollTop = elementOffsetTop - contentBoxOffsetTop;
                }
              });
            });
          }
        });


        dateList.appendChild(dateDiv);
      }
    }


  </script>

  <div id="menu">
    <ul class="menulist">
      <li>
        <a href="https://en.wikipedia.org/wiki/Iris_(plant)" target="_blank">6: 384:1b, Britannica.</a>
      </li>
      <!-- <li>
        <a href="https://lionaire.notion.site/133b9ed57d8e80ae9228d041ead64f8a?pvs=4" target="_blank">ë””ìì´ë„ˆ ë°±ê³¼ì‚¬ì „</a>
      </li> -->
      <!-- <li><a href="archive.html" target="_blank">letter</a></li> -->
      <li></li>
    </ul>
  </div>
  </div>
</body>

</html>